<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zhy.listen.dao.CommentDAO">

	<resultMap id="commentResult" type="com.zhy.listen.bean.Comment">
		<result property="id" column="id" />
		<result property="dependId" column="depend_id" />
		<result property="userId" column="user_id" />
		<result property="reUserId" column="re_user_id" />
		<result property="content" column="content" />
		<result property="reContent" column="re_content" />
		<result property="userName" column="user_name" />
		<result property="reUserName" column="re_user_name" />
		<result property="commentTime" column="comment_time" />
		<result property="modifyTime" column="modify_time" />
		<result property="commentType" column="type" typeHandler="com.zhy.listen.bean.typeHandler.CommentTypeHandler" />
		<result property="isValid" column="is_valid" />
	</resultMap>

	<select id="getCommentsByTypeAndDependId" parameterType="comment"
		resultMap="commentResult">
		SELECT * FROM `comment` WHERE depend_id = #{dependId} AND type= #{commentType.type}
	</select>

	<insert id="save" parameterType="comment">
		INSERT INTO `comment`
		(depend_id, user_id, content, user_name, comment_time, type) 
		VALUES 
		(#{dependId}, #{userId}, #{content}, #{userName}, #{commentTime}, #{commentType.type})
		<selectKey resultType="Long" keyProperty="id">
			SELECT LAST_INSERT_ID()
		</selectKey>
	</insert>

	<!-- 删除评论,更新modify_time,设置is_valid为0 -->
	<update id="delete" parameterType="java.lang.Long">
		UPDATE `comment` SET is_valid=false WHERE id = #{id}
	</update>

</mapper>
